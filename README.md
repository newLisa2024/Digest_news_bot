
---

# Digest News Bot

**Digest News Bot** — это Telegram-бот, который собирает новости об искусственном интеллекте из различных источников (например, [RBC.ru](https://www.rbc.ru/), [TAdviser](https://tadviser.ru/) и т.д.), формирует дайджест и отправляет его подписчикам. Кроме того, бот генерирует краткие саммари с помощью OpenAI, используя ваш API-ключ.

## Возможности

1. **Подписка и отписка**  
   - Команда `/start` — подписывает пользователя на регулярную рассылку AI-новостей.  
   - Команда `/stop` — отписывает пользователя от рассылки.

2. **Автоматическая рассылка дайджеста**  
   - Используется [APScheduler](https://apscheduler.readthedocs.io/) для еженедельной отправки дайджеста в Telegram.

3. **Генерация саммари**  
   - Новости суммируются при помощи OpenAI (ChatGPT), что позволяет быстро просматривать суть большого массива контента.

4. **Админ-панель**  
   - Администраторы бота могут открыть панель с помощью `/admin_menu`.  
   - Возможности для админа:
     - Просматривать список подписчиков.  
     - Удалять подписчиков по ID.  
     - Отправлять индивидуальные сообщения подписчикам.  
     - Делать массовую рассылку.

5. **Google Sheets**  
   - Список подписчиков хранится в Google Таблице, что упрощает управление и мониторинг базы.

6. **Бонус-ссылка**  
   - При подписке бот отправляет пользователям бонус-ссылку (например, на набор промптов).

---

## Требования

- **Python** 3.9+ (рекомендуется)  
- Установленные зависимости из `requirements.txt` (aiogram, openai, apscheduler, beautifulsoup4 и т.д.)
- Аккаунт в Google Cloud для работы с Google Sheets (файл `service_account.json`)
- Действующий ключ OpenAI API (формата `sk-...`)

---

## Установка и запуск

1. **Склонируйте репозиторий**:
   ```bash
   git clone https://github.com/username/digest_news_bot.git
   cd digest_news_bot
   ```

2. **Создайте и активируйте виртуальное окружение** (рекомендуется):
   ```bash
   python -m venv .venv
   source .venv/bin/activate   # для Linux/Mac
   .venv\Scripts\activate      # для Windows
   ```

3. **Установите зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

4. **Сконфигурируйте переменные окружения** в файле `.env`:
   ```bash
   TELEGRAM_TOKEN=твой_телеграм_токен
   OPENAI_API_KEY=твой_openai_ключ
   GOOGLE_SHEETS_CREDENTIALS_FILE=service_account.json
   SPREADSHEET_NAME=DigestNewsSubscribers
   SCHEDULE_DAY_OF_WEEK=tue
   SCHEDULE_HOUR=9
   SCHEDULE_MINUTE=0
   ADMIN_IDS=123456789,987654321
   NEWS_PERIOD_DAYS=2
   ```
   - `TELEGRAM_TOKEN`: токен вашего Telegram-бота.  
   - `OPENAI_API_KEY`: API-ключ OpenAI.  
   - `GOOGLE_SHEETS_CREDENTIALS_FILE`: путь к файлу сервисного аккаунта Google.  
   - `SPREADSHEET_NAME`: название Google Таблицы для хранения подписчиков.  
   - `SCHEDULE_DAY_OF_WEEK`, `SCHEDULE_HOUR`, `SCHEDULE_MINUTE`: расписание отправки дайджеста.  
   - `ADMIN_IDS`: список ID администраторов через запятую.  
   - `NEWS_PERIOD_DAYS`: за сколько дней брать новости (2, 5 и т.д.).

5. **Запустите бота**:
   ```bash
   python bot.py
   ```
   - При запуске бот начнёт опрашивать Telegram и готов к получению команд.
   - Планировщик APScheduler запустится в фоне и будет рассылать дайджест в установленное время.

---

## Использование

- **/start**: подписка на новости. При вводе этой команды бот добавит пользователя в Google Таблицу и отправит приветственное сообщение с бонус-ссылкой.
- **/stop**: отписка от новостей.
- **/admin_menu**: открывает меню администратора (только для тех, чьи ID прописаны в `ADMIN_IDS`).
  - **Список подписчиков**  
  - **Удалить подписчика**  
  - **Отправить сообщение**  
  - **Массовая рассылка**

---

## Структура проекта

- `bot.py` — точка входа: регистрация команд, запуск планировщика, инициализация бота.  
- `config.py` — загрузка и обработка переменных окружения.  
- `modules/`  
  - `admin_menu.py` — обработка админских колбэков и формирование админ-меню.  
  - `admin.py` — команды /list_subscribers, /remove и т.д.  
  - `digest.py` — формирование дайджеста и отправка его пользователям.  
  - `news_aggregator.py` — агрегирует новости из RSS-ленты и других источников.  
  - `rbc_parser.py` — парсит новости с сайта RBC.  
  - `summarizer.py` — вызывает OpenAI для генерации саммари.  
  - `subscriber_db.py` — функции для работы с Google Sheets (добавление, удаление, получение списка подписчиков).  
  - `scheduler.py` — планировщик, который вызывает рассылку по расписанию.  

---

## Docker (необязательно)

Если есть **Dockerfile**, можно собрать образ:
```bash
docker build -t digest-news-bot .
```
и запустить:
```bash
docker run -d --name digest-bot digest-news-bot
```

---

## Контакты и поддержка

- Автор: [Елена](https://t.me/Elena_PromptLab) (telegram)
- Вопросы и предложения: создавать Issue в GitHub или писать в личные сообщения в Telegram.

---

## Лицензия

(Укажи лицензию проекта, например MIT или другую, если необходимо.)

---

